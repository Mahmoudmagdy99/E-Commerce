import{a as F}from"./chunk-GD55XXNO.js";import{U as O,Y as q}from"./chunk-E4RSITYY.js";import{Eb as s,Fb as u,Kb as C,La as D,Ma as M,O as S,R as w,Sa as n,Ta as i,Ua as U,V as p,Yb as _,ac as k,d as g,dc as A,ea as v,hd as j,kc as N,nc as T,oa as d,rb as a,s as x,sb as y,t as I,tb as P,za as E}from"./chunk-UFXSUMZU.js";var B="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";var L=(o=21)=>{let t="",e=crypto.getRandomValues(new Uint8Array(o|=0));for(;o--;)t+=B[e[o]&63];return t};var h=class{id=L();items=[];deliveryMethodId;paymentIntentId;clientSecret};var b=class o{baseUrl=T.apiUrl;http=p(A);cart=v(null);itemCount=C(()=>this.cart()?.items.reduce((t,e)=>t+e.quantity,0));selectedDelivery=v(null);totals=C(()=>{let t=this.cart(),e=this.selectedDelivery();if(!t)return null;let r=t.items.reduce((f,c)=>f+c.price*c.quantity,0),l=e?e.price:0;return{subtotal:r,shipping:l,discount:0,total:r+l-0}});getCart(t){return this.http.get(this.baseUrl+"cart?id="+t).pipe(I(e=>(this.cart.set(e),e)))}setCart(t){return this.http.post(this.baseUrl+"cart",t).pipe(S(e=>{this.cart.set(e)}))}addItemToCart(t,e=1){return g(this,null,function*(){let r=this.cart()??this.createCart();this.isProduct(t)&&(t=this.mapProductToCartItem(t)),r.items=this.addOrUpdateItem(r.items,t,e),yield x(this.setCart(r))})}removeItemFromCart(t,e=1){return g(this,null,function*(){let r=this.cart();if(!r)return;let l=r.items.findIndex(m=>m.productId===t);l!==-1&&(r.items[l].quantity>e?r.items[l].quantity-=e:r.items.splice(l,1),r.items.length===0?this.deleteCart():yield x(this.setCart(r)))})}deleteCart(){this.http.delete(this.baseUrl+"cart?id="+this.cart()?.id).subscribe({next:()=>{localStorage.removeItem("cart_id"),this.cart.set(null)}})}addOrUpdateItem(t,e,r){let l=t.findIndex(m=>m.productId===e.productId);return l===-1?(e.quantity=r,t.push(e)):t[l].quantity+=r,t}mapProductToCartItem(t){return{productId:t.id,productName:t.name,price:t.price,quantity:0,pictureUrl:t.pictureUrl,brand:t.brand,type:t.type}}isProduct(t){return t.id!==void 0}createCart(){let t=new h;return localStorage.setItem("cart_id",t.id),t}static \u0275fac=function(e){return new(e||o)};static \u0275prov=w({token:o,factory:o.\u0275fac,providedIn:"root"})};function H(o,t){o&1&&(n(0,"div",12)(1,"button",19),a(2,"Checkout"),i(),n(3,"button",20),a(4,"Continue Shopping"),i()())}var R=class o{cartService=p(b);location=p(_);static \u0275fac=function(e){return new(e||o)};static \u0275cmp=E({type:o,selectors:[["app-order-summary"]],decls:41,vars:13,consts:[[1,"mx-auto","max-w-4xl","flex-1","space-y-6","w-full"],[1,"space-y-4","rounded-lg","border","border-gray-200","bg-white","p-4","shadow-sm"],[1,"text-xl","font-semibold"],[1,"space-y-4"],[1,"space-y-2"],[1,"flex","items-center","justify-between","gap-4"],[1,"font-medium","text-gray-500"],[1,"font-medium","text-gray-900"],[1,"font-medium","text-green-500"],[1,"flex","items-center","justify-between","gap-4","border-t","border-gray-200","pt-2"],[1,"font-bold","text-gray-900"],[1,"font-semibold","text-gray-900"],[1,"flex","flex-col","gap-2"],[1,"space-y-4","rounded-lg","border","border-gray-200","bg-white","shadow-sm"],[1,"space-y-2","flex","flex-col","p-2"],[1,"mb-2","block","text-sm","font-medium"],["appearance","outline"],["matInput","","type","text"],["mat-flat-button",""],["routerLink","/checkout","mat-flat-button",""],["routerLink","/shop","mat-button",""]],template:function(e,r){if(e&1&&(n(0,"div",0)(1,"div",1)(2,"p",2),a(3,"Order summary"),i(),n(4,"div",3)(5,"div",4)(6,"dl",5)(7,"dt",6),a(8,"Subtotal"),i(),n(9,"dd",7),a(10),s(11,"currency"),i()(),n(12,"dl",5)(13,"dt",6),a(14,"Discount"),i(),n(15,"dd",8),a(16),s(17,"currency"),i()(),n(18,"dl",5)(19,"dt",6),a(20,"Delivery fee"),i(),n(21,"dd",7),a(22),s(23,"currency"),i()()(),n(24,"dl",9)(25,"dt",10),a(26,"Total"),i(),n(27,"dd",11),a(28),s(29,"currency"),i()()(),D(30,H,5,0,"div",12),i(),n(31,"div",13)(32,"form",14)(33,"label",15),a(34,"Do you have a voucher code?"),i(),n(35,"mat-form-field",16)(36,"mat-label"),a(37,"Voucher code"),i(),U(38,"input",17),i(),n(39,"button",18),a(40,"Apply code"),i()()()()),e&2){let l,m,f,c;d(10),y(u(11,5,(l=r.cartService.totals())==null?null:l.subtotal)),d(6),P(" -",u(17,7,(m=r.cartService.totals())==null?null:m.discount)," "),d(6),y(u(23,9,(f=r.cartService.totals())==null?null:f.shipping)),d(6),y(u(29,11,(c=r.cartService.totals())==null?null:c.total)),d(2),M(r.location.path()!=="/checkout"?30:-1)}},dependencies:[q,O,j,N,F,k],encapsulation:2})};export{b as a,R as b};
